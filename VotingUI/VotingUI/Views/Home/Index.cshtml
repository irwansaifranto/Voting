@model List<VotingUI.Models.Voting.ModelVotingView>

@{
    ViewData["Title"] = "Home Page";
}

@foreach (var voting in Model)
{
    <div class="row mt-5">
        <div class="col-xs-12 col-md-12">
            <h4 class="text-center font-weight-bold"># Voting Item - @voting.VotingProcessName</h4>
            <div class="well well-sm">
                <div class="row">
                    <div class="col-xs-12 col-md-3 offset-md-3 text-center">
                        <h1 class="rating-num" id="rating-num-@voting.VotingProcessId">
                            @voting.StarValue.Value / 5.0
                        </h1>
                        <div class="rating">
                            <span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star">
                            </span><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star">
                            </span><span class="glyphicon glyphicon-star-empty"></span>
                        </div>
                        <div>
                            <span class="glyphicon glyphicon-user" id="total-reviewers-@voting.VotingProcessId">@voting.Reviewers Total</span>
                        </div>
                        <div>
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                            <i class="fa fa-star" aria-hidden="true"></i>
                        </div>
                        <div class="mt-2 mb-2">
                            <text>Open  : <span class="font-weight-bold">@voting.StringCreatedDate</span></text><br />
                            @if (DateTime.Now.Date > voting.DueDate.Date)
                            {
                                <text>Close : <span class="font-weight-bold text-danger">@voting.StringDueDate</span></text>
                            }
                            else
                            {
                                <text>Close : <span class="font-weight-bold">@voting.StringDueDate</span></text>
                            }

                        </div>
                    </div>
                    <div class="col-xs-12 col-md-3 mt-3">
                        <div class="row rating-desc">
                            <div class="col-xs-3 col-md-3 text-right">
                                <span class="glyphicon glyphicon-star"></span>5
                            </div>
                            <div class="col-xs-8 col-md-9">
                                <div class="progress progress-striped">
                                    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="20"
                                         aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                        <span class="sr-only">80%</span>
                                    </div>
                                </div>
                            </div>
                            <!-- end 5 -->
                            <div class="col-xs-3 col-md-3 text-right">
                                <span class="glyphicon glyphicon-star"></span>4
                            </div>
                            <div class="col-xs-8 col-md-9">
                                <div class="progress">
                                    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="20"
                                         aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                        <span class="sr-only">60%</span>
                                    </div>
                                </div>
                            </div>
                            <!-- end 4 -->
                            <div class="col-xs-3 col-md-3 text-right">
                                <span class="glyphicon glyphicon-star"></span>3
                            </div>
                            <div class="col-xs-8 col-md-9">
                                <div class="progress">
                                    <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20"
                                         aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                        <span class="sr-only">40%</span>
                                    </div>
                                </div>
                            </div>
                            <!-- end 3 -->
                            <div class="col-xs-3 col-md-3 text-right">
                                <span class="glyphicon glyphicon-star"></span>2
                            </div>
                            <div class="col-xs-8 col-md-9">
                                <div class="progress">
                                    <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="20"
                                         aria-valuemin="0" aria-valuemax="100" style="width: 20%">
                                        <span class="sr-only">20%</span>
                                    </div>
                                </div>
                            </div>
                            <!-- end 2 -->
                            <div class="col-xs-3 col-md-3 text-right">
                                <span class="glyphicon glyphicon-star"></span>1
                            </div>
                            <div class="col-xs-8 col-md-9">
                                <div class="progress">
                                    <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80"
                                         aria-valuemin="0" aria-valuemax="100" style="width: 15%">
                                        <span class="sr-only">15%</span>
                                    </div>
                                </div>
                            </div>
                            <!-- end 1 -->
                        </div>
                        <!-- end row -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row justify-content-around text-center">
        <div class="form-group" id="rating-ability-wrapper">
            <label class="control-label" for="rating">
                <span class="field-label-header">Would you like to rate this topic item #@voting.VotingProcessName ??? </span><br>
                <span class="field-label-info"></span>
                <input type="hidden" id="selected_rating-@voting.VotingProcessId" name="selected_rating-@voting.VotingProcessId" value="" required="required">
            </label>
            <h2 class="bold rating-header" style="">
                <span class="selected-rating-@voting.VotingProcessId">0</span><small> / 5</small>
            </h2>
            <button type="button" class="btnrating-@voting.VotingProcessId btn btn-default btn-lg" vote-item="@voting.VotingProcessId" onclick="setValue(this)" data-attr="1" id="rating-star-1">
                <i class="far fa-star" aria-hidden="true"></i>
            </button>
            <button type="button" class="btnrating-@voting.VotingProcessId btn btn-default btn-lg" vote-item="@voting.VotingProcessId" onclick="setValue(this)" data-attr="2" id="rating-star-2">
                <i class="far fa-star" aria-hidden="true"></i>
            </button>
            <button type="button" class="btnrating-@voting.VotingProcessId btn btn-default btn-lg" vote-item="@voting.VotingProcessId" onclick="setValue(this)" data-attr="3" id="rating-star-3">
                <i class="far fa-star" aria-hidden="true"></i>
            </button>
            <button type="button" class="btnrating-@voting.VotingProcessId btn btn-default btn-lg" vote-item="@voting.VotingProcessId" onclick="setValue(this)" data-attr="4" id="rating-star-4">
                <i class="far fa-star" aria-hidden="true"></i>
            </button>
            <button type="button" class="btnrating-@voting.VotingProcessId btn btn-default btn-lg" vote-item="@voting.VotingProcessId" onclick="setValue(this)" data-attr="5" id="rating-star-5">
                <i class="far fa-star" aria-hidden="true"></i>
            </button>
            <div>
                <button type="button" class="btn btn-success ml-3 mb-4 mt-3" id="btn-submit-vote-@voting.VotingProcessId" onclick="submitValue(@voting.VotingProcessId)"><i class="fa fa-thumbs-up" aria-hidden="true"></i> Vote</button>
            </div>

        </div>

    </div>
}

@section Scripts {
    <script type="text/javascript">

        function setValue(el) {
            var selected_item = $(el).attr('vote-item');
            var selected_value = $(el).attr('data-attr');
            $("#selected_rating-" + selected_item).val(selected_value);
            $(".selected-rating-" + selected_item).html(selected_value);
        }

        function submitValue(item) {
            var selected_value = $("#selected_rating-" + item).val();

            if (selected_value != '') {
                var model = new FormData();

                model.append('VotingProcessId', item);
                model.append('VotingValue', selected_value);

                $.when(WEBPORTAL.Services.POSTLocal(model, WEBPORTAL.URLContext.SubmitVote, false, false)).done(function (result, status, xhr) {
                    var resultObject = JSON.parse(result);
                    console.log(resultObject);
                    if (resultObject.Code === 200) {
                        resetVotemItemValue();
                        disableButton(item);
                        countTotalReviewers(item, resultObject.Data.reviewers);
                        countRate(item, resultObject.Data.starValue);
                        WEBPORTAL.Utility.ConstructNotificationSuccess(resultObject.Message);
                    } else if (resultObject.Code === 6000) {
                        WEBPORTAL.Utility.ConstructNotificationError(resultObject.Message);
                    }
                    else if (resultObject.Code === 6001) {
                        WEBPORTAL.Utility.ConstructNotificationError(resultObject.Message);
                    }
                    else {
                        WEBPORTAL.Utility.ConstructNotificationError(resultObject.Message);
                    }
                });
            } else {
                WEBPORTAL.Utility.ConstructNotificationError("Please select at least one star before submit your vote !!!");
            }
        }

        function resetVotemItemValue(item) {
            $("#selected_rating-" + item).val('');
        }

        function disableButton(item) {
            $("#btn-submit-vote-" + item).prop('disabled', true); 
        }

        function countTotalReviewers(item, reviewers) {
            $("#total-reviewers-" + item).html(reviewers + " Total");
        }

        function countRate(item, starValue) {
            $("#rating-num-" + item).html(starValue + " / 5.0");
        }

        function countStar() {
        }
    </script>
}